Version 4
SHEET 1 1264 680
WIRE -16 -304 -544 -304
WIRE 720 -304 -16 -304
WIRE 896 -304 720 -304
WIRE 720 -288 720 -304
WIRE 304 -256 256 -256
WIRE 416 -256 384 -256
WIRE 896 -208 896 -304
WIRE 720 -192 720 -208
WIRE 848 -192 720 -192
WIRE -544 -96 -544 -304
WIRE 256 -80 256 -256
WIRE 256 -80 176 -80
WIRE 416 -48 416 -256
WIRE 896 -32 896 -112
WIRE -16 48 -16 -304
WIRE 48 64 16 64
WIRE 720 64 720 -192
WIRE -48 80 -64 80
WIRE 176 96 176 -80
WIRE 176 96 16 96
WIRE -64 144 -64 80
WIRE 672 144 -64 144
WIRE 896 160 896 32
WIRE 896 160 800 160
WIRE 896 192 896 160
WIRE 48 288 48 64
WIRE 800 288 800 160
WIRE 800 288 48 288
WIRE -544 304 -544 -16
WIRE -112 304 -112 256
WIRE -112 304 -544 304
WIRE -16 304 -16 112
WIRE -16 304 -112 304
WIRE 720 304 720 160
WIRE 720 304 -16 304
WIRE 896 304 896 272
WIRE 896 304 720 304
WIRE -544 320 -544 304
FLAG -544 320 0
FLAG 416 -48 0
FLAG 256 -256 PWM_IN
IOPIN 256 -256 In
SYMBOL Misc\\battery -544 -112 R0
WINDOW 123 0 0 Left 0
WINDOW 39 10 136 Left 2
WINDOW 3 11 101 Left 2
SYMATTR SpiceLine Rser=20m
SYMATTR Value {Vcc}
SYMATTR InstName V1
SYMBOL LED 880 -32 R0
SYMATTR InstName D1
SYMATTR Value NSCW100
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res 880 176 R0
SYMATTR InstName Rsense
SYMATTR Value 1R
SYMBOL res 704 -304 R0
SYMATTR InstName R4
SYMATTR Value 100k
SYMBOL pmos 848 -112 M180
SYMATTR InstName M1
SYMATTR Value RSL020P03
SYMBOL nmos 672 64 R0
WINDOW 3 -5 73 VLeft 2
SYMATTR Value BSB012N03LX3
SYMATTR InstName M2
SYMBOL voltage 288 -256 M90
WINDOW 123 0 0 Left 0
WINDOW 39 24 44 Left 2
SYMATTR SpiceLine Rser=1m
SYMATTR InstName V2
SYMATTR Value 10m
SYMBOL Opamps\\AD811 -16 16 M0
SYMATTR InstName U2
TEXT -512 328 Left 2 !.tran 100m startup
TEXT -512 392 Left 2 !.param Vcc=5V Tperiod=10u Ton=({Tperiod} *{Duty})
TEXT -512 360 Left 2 ;.step param Duty 0 0.2 0.01
TEXT -144 360 Left 2 !.param Duty=0.5
