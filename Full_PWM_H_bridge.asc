Version 4
SHEET 1 1876 716
WIRE -896 -208 -1056 -208
WIRE -192 -208 -896 -208
WIRE 0 -208 -192 -208
WIRE 64 -208 0 -208
WIRE 208 -208 64 -208
WIRE 592 -208 208 -208
WIRE 736 -208 592 -208
WIRE 800 -208 736 -208
WIRE 992 -208 800 -208
WIRE -192 -192 -192 -208
WIRE 992 -192 992 -208
WIRE 0 -144 0 -208
WIRE 800 -144 800 -208
WIRE -192 -96 -192 -112
WIRE -80 -96 -192 -96
WIRE -64 -96 -80 -96
WIRE 880 -96 864 -96
WIRE 992 -96 992 -112
WIRE 992 -96 880 -96
WIRE -80 -80 -80 -96
WIRE 880 -80 880 -96
WIRE 208 -48 208 -208
WIRE 592 -48 592 -208
WIRE -192 -32 -192 -96
WIRE -192 -32 -352 -32
WIRE 0 -32 0 -48
WIRE 160 -32 0 -32
WIRE 800 -32 800 -48
WIRE 800 -32 640 -32
WIRE 992 -32 992 -96
WIRE 1120 -32 992 -32
WIRE 0 -16 0 -32
WIRE 800 -16 800 -32
WIRE -1056 0 -1056 -208
WIRE -896 0 -896 -208
WIRE -80 0 -80 -16
WIRE 880 0 880 -16
WIRE -640 16 -800 16
WIRE -416 16 -480 16
WIRE 1248 16 1184 16
WIRE 1584 16 1408 16
WIRE -192 32 -192 -32
WIRE -160 32 -192 32
WIRE -64 32 -80 32
WIRE 880 32 864 32
WIRE 992 32 992 -32
WIRE 992 32 960 32
WIRE -640 64 -704 64
WIRE -432 64 -464 64
WIRE 1232 64 1200 64
WIRE 1488 64 1408 64
WIRE -704 80 -704 64
WIRE 1488 80 1488 64
WIRE -800 96 -800 16
WIRE -352 96 -352 64
WIRE 0 96 0 80
WIRE 208 96 208 48
WIRE 320 96 208 96
WIRE 352 96 320 96
WIRE 480 96 432 96
WIRE 592 96 592 48
WIRE 592 96 480 96
WIRE 800 96 800 80
WIRE 1584 96 1584 16
WIRE 64 112 64 -208
WIRE 736 112 736 -208
WIRE 1120 128 1120 64
WIRE 208 144 208 96
WIRE 592 144 592 96
WIRE -96 160 -128 160
WIRE 0 160 -16 160
WIRE 816 160 800 160
WIRE 928 160 896 160
WIRE -16 176 -16 160
WIRE 320 176 320 96
WIRE 368 176 320 176
WIRE 480 176 480 96
WIRE 480 176 432 176
WIRE 816 176 816 160
WIRE -800 208 -800 176
WIRE -704 208 -704 160
WIRE -704 208 -800 208
WIRE -640 208 -640 112
WIRE -640 208 -704 208
WIRE 1408 208 1408 112
WIRE 1488 208 1488 160
WIRE 1488 208 1408 208
WIRE 1584 208 1584 176
WIRE 1584 208 1488 208
WIRE -800 224 -800 208
WIRE -432 224 -432 64
WIRE -128 224 -128 160
WIRE -128 224 -432 224
WIRE 64 224 64 208
WIRE 160 224 64 224
WIRE 736 224 736 208
WIRE 736 224 640 224
WIRE 928 224 928 160
WIRE 1200 224 1200 64
WIRE 1200 224 928 224
WIRE 1584 224 1584 208
WIRE 64 240 64 224
WIRE 736 240 736 224
WIRE -16 256 -16 240
WIRE 816 256 816 240
WIRE 208 272 208 240
WIRE 400 272 208 272
WIRE 592 272 592 240
WIRE 592 272 400 272
WIRE -224 288 -256 288
WIRE -128 288 -128 224
WIRE 0 288 -128 288
WIRE 928 288 928 224
WIRE 928 288 800 288
WIRE 400 304 400 272
WIRE 64 352 64 336
WIRE 736 352 736 336
WIRE -224 384 -224 368
WIRE -224 384 -288 384
WIRE -144 384 -224 384
WIRE 352 384 -144 384
WIRE -144 400 -144 384
WIRE -288 416 -288 384
WIRE -64 448 -80 448
WIRE 16 448 -64 448
WIRE 224 448 96 448
WIRE 288 448 256 448
WIRE 400 448 400 400
WIRE 400 448 368 448
WIRE -1056 512 -1056 80
WIRE -896 512 -896 64
WIRE -896 512 -1056 512
WIRE -288 512 -288 480
WIRE -288 512 -896 512
WIRE -144 512 -144 496
WIRE -144 512 -288 512
WIRE 160 512 160 352
WIRE -1056 528 -1056 512
WIRE 224 528 224 448
WIRE 224 528 192 528
WIRE 320 528 224 528
WIRE -64 544 -64 448
WIRE 128 544 -64 544
WIRE 400 544 400 448
WIRE 224 560 192 560
WIRE 256 560 256 448
WIRE 256 560 224 560
WIRE 320 576 320 528
WIRE 224 592 224 560
WIRE -144 688 -144 512
WIRE 160 688 160 576
WIRE 160 688 -144 688
WIRE 224 688 224 672
WIRE 224 688 160 688
WIRE 320 688 320 656
WIRE 320 688 224 688
WIRE 400 688 400 624
WIRE 400 688 320 688
FLAG -1056 528 0
FLAG -800 224 0
FLAG 64 352 0
FLAG 0 96 0
FLAG -352 96 0
FLAG -16 256 0
FLAG -80 0 0
FLAG 1584 224 0
FLAG 736 352 0
FLAG 800 96 0
FLAG 1120 128 0
FLAG 816 256 0
FLAG 880 0 0
FLAG -1056 -208 Vcc
IOPIN -1056 -208 BiDir
FLAG 160 352 Vcc
IOPIN 160 352 BiDir
FLAG -256 288 Vcc
IOPIN -256 288 BiDir
SYMBOL pmos 160 48 M180
SYMATTR InstName M2
SYMATTR Value IRF7309P
SYMBOL Digital\\dflop -560 -32 R0
SYMATTR InstName A1
SYMATTR SpiceLine Vhigh=5V Trise=10n Tfall=10n Td=1n Rlow=50
SYMBOL nmos 160 144 R0
SYMATTR InstName M3
SYMATTR Value IRLML6346
SYMBOL voltage -800 80 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -237 494 Left 2
SYMATTR Value PULSE(0 5 1m 10n 10n {dir_period * duty * 2} {dir_period*2} {cycles})
SYMATTR InstName V1
SYMBOL voltage -1056 -16 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
SYMATTR SpiceLine Rser=10m
SYMATTR InstName V2
SYMATTR Value 6V
SYMBOL voltage -704 64 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -335 543 Left 2
SYMATTR Value PULSE(0 5 {dir_period/3000} 10n 10n {dir_period/200} {dir_period/100})
SYMATTR InstName V3
SYMBOL nmos 352 304 R0
SYMATTR InstName M5
SYMATTR Value BSC082N10LS
SYMBOL npn -80 400 M0
SYMATTR InstName Q2
SYMATTR Value 2N2222
SYMBOL res -240 272 R0
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL ind 336 112 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 1m
SYMATTR SpiceLine Rser=5R
SYMBOL cap -912 0 R0
SYMATTR InstName C1
SYMATTR Value 100µ
SYMBOL cap 432 160 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 10n
SYMBOL npn 0 112 R0
SYMATTR InstName Q3
SYMATTR Value 2N2222
SYMBOL pnp 0 336 M180
SYMATTR InstName Q4
SYMATTR Value 2N2907
SYMBOL npn -64 -144 R0
SYMATTR InstName Q5
SYMATTR Value 2N2222
SYMBOL pnp -64 80 M180
SYMATTR InstName Q6
SYMATTR Value 2N2907
SYMBOL res -208 -208 R0
SYMATTR InstName R6
SYMATTR Value 10k
SYMBOL npn -416 -32 R0
SYMATTR InstName Q7
SYMATTR Value 2N2222
SYMBOL res 0 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 10k
SYMBOL res -64 16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 100k
SYMBOL cap -32 176 R0
SYMATTR InstName C4
SYMATTR Value 1n
SYMBOL cap -96 -80 R0
SYMATTR InstName C5
SYMATTR Value 470p
SYMBOL pmos 640 48 R180
SYMATTR InstName M1
SYMATTR Value IRF7309P
SYMBOL Digital\\dflop 1328 -32 M0
SYMATTR InstName A2
SYMATTR SpiceLine Vhigh=5V Trise=10n Tfall=10n Td=1n Rlow=50
SYMBOL nmos 640 144 M0
SYMATTR InstName M4
SYMATTR Value IRLML6346
SYMBOL voltage 1584 80 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -4 432 Left 2
SYMATTR Value PULSE(0 5 {1m+cycles*dir_period*2} 10n 10n {dir_period*duty*2} {dir_period*2} {cycles})
SYMATTR InstName V4
SYMBOL voltage 1488 64 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -110 421 Left 2
SYMATTR Value PULSE(0 5 {dir_period/3000} 10n 10n {dir_period/200} {dir_period/100})
SYMATTR InstName V5
SYMBOL npn 800 112 M0
SYMATTR InstName Q1
SYMATTR Value 2N2222
SYMBOL pnp 800 336 R180
SYMATTR InstName Q8
SYMATTR Value 2N2907
SYMBOL npn 864 -144 M0
SYMATTR InstName Q9
SYMATTR Value 2N2222
SYMBOL pnp 864 80 R180
SYMATTR InstName Q10
SYMATTR Value 2N2907
SYMBOL res 1008 -208 M0
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL npn 1184 -32 M0
SYMATTR InstName Q11
SYMATTR Value 2N2222
SYMBOL res 800 144 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL res 864 16 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 100k
SYMBOL cap 832 176 M0
SYMATTR InstName C6
SYMATTR Value 1n
SYMBOL cap 896 -80 M0
SYMATTR InstName C7
SYMATTR Value 470p
SYMBOL res 384 528 R0
SYMATTR InstName R_sense1
SYMATTR Value 50m
SYMBOL Opamps\\AD822 160 480 M0
SYMATTR InstName U1
SYMBOL res 112 432 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 27 60 VTop 2
SYMATTR InstName R_currentSet
SYMATTR Value {R_currentLimit}
SYMBOL res 304 560 R0
SYMATTR InstName R10
SYMATTR Value 1k
SYMBOL res 384 432 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 1k
SYMBOL res 208 576 R0
SYMATTR InstName R12
SYMATTR Value 100k
SYMBOL cap -304 416 R0
SYMATTR InstName C3
SYMATTR Value 10n
TEXT -1040 536 Left 2 !.tran 0 100m 0.8m
TEXT -888 376 Left 2 !.param dir_period=30u
TEXT -888 416 Left 2 !.param duty=0.1 cycles=1000
TEXT -888 488 Left 2 !.param R_currentLimit={(0.65/(I_set*50m))*1k}
TEXT -888 456 Left 2 !.param I_set=200mA
TEXT 616 608 Left 2 !.meas TRAN res1 PARAM R_currentSet
